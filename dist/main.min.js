function exportToCsv(e,t){for(var n="",i=0;i<t.length;i++)n+=function(e){for(var t="",n=0;n<e.length;n++){var i=null===e[n]||void 0===e[n]?"":e[n].toString(),i=(i=e[n]instanceof Date?e[n].toLocaleString():i).replace(/"/g,'""');0<n&&(t+=","),t+=i=0<=i.search(/("|,|\n)/g)?'"'+i+'"':i}return t+"\n"}(t[i]);var r=new Blob([n],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a");void 0!==o.download&&(r=URL.createObjectURL(r),o.setAttribute("href",r),o.setAttribute("download",e),document.body.appendChild(o),o.click(),document.body.removeChild(o))}function buildCTABtn(){const e=document.createElement("div");e.setAttribute("style",["position: fixed;","top: 0;","left: 0;","z-index: 10;","width: 100%;","height: 100%;","pointer-events: none;"].join(""));const t=document.createElement("div");t.setAttribute("style",["position: absolute;","bottom: 80px;","right: 130px;","color: white;","min-width: 150px;","background: blue;","border-radius: 8px","padding: 0px 12px;","cursor: pointer;","font-weight:600;","font-size:15px;","display: inline-flex;","pointer-events: auto;","height: 36px;","align-items: center;","justify-content: center;"].join(""));var n=document.createTextNode("Download ");const i=document.createElement("span");i.setAttribute("id","linkedin-scraper-number-tracker"),i.textContent="0";var r=document.createTextNode(" members");return t.appendChild(n),t.appendChild(i),t.appendChild(r),t.addEventListener("click",function(){var e=(new Date).toISOString();const n=[["Search Terms","LinkedInUrl","First Name","Last Name","Full Name","Title","Location","Is Premium","Summary"]];function i(e){return e||""}window.profiles_list.forEach((e,t)=>{e.linkedInProfileUrl&&e.searchTerms&&n.push([e.searchTerms,e.linkedInProfileUrl,i(e.firstName),i(e.lastName),i(e.fullName),i(e.title),i(e.location),e.isPremium?"True":"False",i(e.summary)])}),exportToCsv(`linkedInProfilesExport-${e}.csv`,n)}),e.appendChild(t),document.body.appendChild(e),e}function isProfile1(e){return"com.linkedin.voyager.dash.search.EntityResultViewModel"===e.$type&&!!e.navigationUrl&&-1!==e.navigationUrl.indexOf("linkedin.com/in/")}function isProfile2(e){return"com.linkedin.voyager.dash.identity.profile.Profile"===e.$type}function cleanLinkedInUrl(e){const t=new URL(e);return t.search="",t.hash="",t.toString()}function findProfileUsingFSDProfile(e){for(var[t,n]of window.profiles_list.entries())if(n.fsdProfile&&n.fsdProfile===e)return t;return null}function processResponse(e,u){let t;if(null!=e&&e.included){const n=(t=null==e?void 0:e.included).filter(e=>isProfile1(e)||isProfile2(e));if(0!==n.length){n.forEach(e=>{console.log(e);let t,n=!1;if(isProfile1(e))t=function(e){var t=null==e?void 0:e.navigationUrl;if(!t)return null;const n=null==e?void 0:e.entityUrn;let i;var r=n.match(/fsd_profile:(?<profile>(\w+))/);if(!(i=r&&r.groups&&r.groups.profile?r.groups.profile:i))return null;var r=null===(r=null==e?void 0:e.title)||void 0===r?void 0:r.text,o=null===(o=null==e?void 0:e.primarySubtitle)||void 0===o?void 0:o.text,l=null===(l=null==e?void 0:e.secondarySubtitle)||void 0===l?void 0:l.text,s=null===(s=null==e?void 0:e.summary)||void 0===s?void 0:s.text;let a=!1;null!=e&&e.badgeIcon&&(a=!0);const d={fsdProfile:i,linkedInProfileUrl:cleanLinkedInUrl(t),isPremium:a};return u&&(d.searchTerms=u),r&&(d.fullName=r),o&&(d.title=o),l&&(d.location=l),s&&(d.summary=s),d}(e),console.log(`Profile1 ${t.fullName} - ${t.firstName} - `+t.lastName);else{if(!isProfile2(e))throw new Error("Invalid profile");t=function(e){const t=null==e?void 0:e.entityUrn;let n;if(!t)return null;var i=t.match(/fsd_profile:(?<profile>(\w+))/);if(!(n=i&&i.groups&&i.groups.profile?i.groups.profile:n))return null;const r={fsdProfile:n};var i=null==e?void 0:e.publicIdentifier,o=null==e?void 0:e.firstName,l=null==e?void 0:e.lastName,e=null==e?void 0:e.headline;return i&&(r.linkedInProfileUrl="https://www.linkedin.com/in/"+i),o&&(r.firstName=o),l&&(r.lastName=l),e&&(r.title=e),u&&(r.searchTerms=u),r}(e),console.log(`Profile2 ${t.fullName} - ${t.firstName} - `+t.lastName),n=!0}t&&(console.log("fsdProfile: "+t.fsdProfile),(e=window.profiles_list.get(t.fsdProfile))?(console.log("Merge"),window.profiles_list.set(t.fsdProfile,{...e,...t})):n||window.profiles_list.set(t.fsdProfile,t))});const i=document.getElementById("linkedin-scraper-number-tracker");if(i){const r=new Map([...window.profiles_list].filter(([,e])=>!!e.linkedInProfileUrl&&!!e.searchTerms));i.textContent=r.size.toString()}}}}function parseResponse(e,t){var t=t.match(/\(keywords:(?<search_term>.+?)(?=,)/),n=t&&t.groups&&t.groups.search_term?decodeURIComponent(t.groups.search_term):null;let i=[];try{i.push(JSON.parse(e))}catch(e){console.error("Fail to parse API response",e)}for(let e=0;e<i.length;e++)processResponse(i[e],n)}function main(){buildCTABtn();const o=/start:(?<start>\d+)/gi,l=XMLHttpRequest.prototype.open,e=(XMLHttpRequest.prototype.open=function(){const e=arguments[1];if(-1!==e.indexOf("/voyager/api/graphql")&&-1!==e.indexOf("value:List(PEOPLE)")){const i=arguments,r=arguments[1];o.lastIndex=0;var t=o.exec(r);if(t){var n,t=null===(t=null==t?void 0:t.groups)||void 0===t?void 0:t.start;if(t)return n=parseInt(t)/10,i[1]=r.replace("start:"+t,"count:50,start:"+50*n),l.apply(this,i)}}return l.apply(this,arguments)},XMLHttpRequest.prototype.send);XMLHttpRequest.prototype.send=function(){this.addEventListener("readystatechange",function(){if(4===this.readyState){let e=this.responseURL.includes("/voyager/api/graphql");if(e=e&&-1!==this.responseURL.indexOf("value:List(ALL)")?!1:e){const t=new FileReader;t.onloadend=e=>{try{parseResponse(t.result,this.responseURL)}catch(e){console.error(e)}},t.readAsText(this.response)}}},!1),e.apply(this,arguments)}}window.profiles_list=window.profiles_list||new Map,main();